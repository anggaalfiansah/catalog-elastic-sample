services:
  # ----------------------------
  # 1. MySQL (Image Official Docker Hub)
  # ----------------------------
  postgres:
    image: postgres:16-alpine
    container_name: catalog_postgres
    restart: always
    environment:
      POSTGRES_USER: user_catalog
      POSTGRES_PASSWORD: userpassword
      POSTGRES_DB: catalog_db
    ports:
      - "5450:5432" # <-- Kita akses via port 5450 (biar aman dari postgres lokal lain)
    volumes:
      - ./volumes/postgres:/var/lib/postgresql/data

  # ----------------------------
  # 2. Elasticsearch (Image Official Elastic.co)
  # ----------------------------
  elasticsearch:
    image: elastic/elasticsearch:9.2.3 # <-- Versi Stabil & Gratis
    container_name: catalog_elastic
    environment:
      - node.name=es01
      - cluster.name=erp-cluster
      - discovery.type=single-node
      - xpack.security.enabled=false
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "9200:9200"
    volumes:
      - ./volumes/elastic:/usr/share/elasticsearch/data

  # ----------------------------
  # 3. Kibana (Image Official Elastic.co)
  # ----------------------------
  kibana:
    image: elastic/kibana:9.2.3 # <-- Versi disamakan dengan ES
    container_name: catalog_kibana
    ports:
      - "5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    depends_on:
      - elasticsearch